<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>PaymentSDK Playground</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <meta name="theme-color" content="#8d204a">
    <meta name="sdk-theme" content="(start-color: #721053, end-color: #AD2E41)">


</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<div class="container p-3">

    <h2>PaymentSDK Playground</h2>

    <div class="accordion mt-3" id="accordionExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingSms">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSms" aria-expanded="true" aria-controls="collapseOne">
                    Read SMS
                </button>
            </h2>
            <div id="collapseSms" class="accordion-collapse collapse" aria-labelledby="headingSms" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <button type="button" id="read-sms-btn" class="btn btn-primary">Read SMS</button>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingScanCreditCard">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseScanCreditCard" aria-expanded="true" aria-controls="collapseOne">
                    Scan Credit Card
                </button>
            </h2>
            <div id="collapseScanCreditCard" class="accordion-collapse collapse" aria-labelledby="headingScanCreditCard" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <button type="button" id="scan-credit-card-btn" class="btn btn-primary">Scan credit card</button>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Initialize
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <form id="initialize-form">
                        <div class="form-group mb-3">

                            <label for="initialize-customerId">Customer Id</label>
                            <input type="text" class="form-control" id="initialize-customerId" placeholder="Customer Id" value="cth_7UMaUzPGTTpcbLop">

                            <label for="initialize-merchantId">Merchant Id</label>
                            <input type="text" class="form-control" id="initialize-merchantId" placeholder="Merchant Id" value="ixigo">

                            <label for="initialize-clientId">Client Id</label>
                            <input type="text" class="form-control" id="initialize-clientId" placeholder="Client Id" value="ixigo_ANDROID">

                            <label for="initialize-provider">Provider</label>
                            <input type="text" class="form-control" id="initialize-provider" placeholder="Provider" value="JUSPAY">
                        </div>

                        <button type="button" id="initialize-btn" class="btn btn-primary">Initialize</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Get Available UPI Apps
                </button>
            </h2>
            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <form>
                        <div class="form-group mb-3">

                            <label for="upi-apps-provider">Provider</label>
                            <input type="text" class="form-control" id="upi-apps-provider" placeholder="Provider" value="JUSPAY">

                            <label for="upi-apps-orderId">Order Id</label>
                            <input type="text" class="form-control" id="upi-apps-orderId" placeholder="Order Id" value="2IQIQW5TSWQ5FSK5Y">
                        </div>

                        <button type="button" id="upi-apps-btn" class="btn btn-primary">Get Available UPI Apps</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingThree">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Process UPI Intent
                </button>
            </h2>
            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <form>
                        <div class="form-group mb-3">

                            <label for="upi-intent-provider">Provider</label>
                            <input type="text" class="form-control" id="upi-intent-provider" placeholder="Provider" value="JUSPAY">

                            <label for="upi-intent-orderId">Order Id</label>
                            <input type="text" class="form-control" id="upi-intent-orderId" placeholder="Order Id" value="2IQIQW5TSWQ5FSK5Y">

                            <label for="upi-intent-app-package">App Package</label>
                            <input type="text" class="form-control" id="upi-intent-app-package" placeholder="App Package" value="com.phonepe.app">

                            <label for="upi-intent-display-note">Display Note</label>
                            <input type="text" class="form-control" id="upi-intent-display-note" placeholder="My Display Note" value="Lorem Ipsum">

                            <label for="upi-intent-client-auth-token">Client Auth Token</label>
                            <input type="text" class="form-control" id="upi-intent-client-auth-token" placeholder="Client Auth Token" value="tkn_bcac6fc8f2ee402d80fe7caf3607837f">

                            <label for="upi-intent-end-url">End Url</label>
                            <input type="text" class="form-control" id="upi-intent-end-url" placeholder="End Url" value="https://www.ixigo.com/payments/juspay/callback/MWEB.*">

                            <label for="upi-intent-amount">Amount</label>
                            <input type="number" class="form-control" id="upi-intent-amount" placeholder="Amount" value="100.12">
                        </div>

                        <button type="button" id="upi-intent-btn" class="btn btn-primary">Process UPI Intent</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingWallets">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWallets" aria-expanded="false" aria-controls="collapseWallets">
                    Refresh Wallets
                </button>
            </h2>
            <div id="collapseWallets" class="accordion-collapse collapse" aria-labelledby="headingWallets" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <button type="button" id="refresh-wallets-btn" class="btn btn-primary">Refresh Wallets</button>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingCreateWallet">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCreateWallet" aria-expanded="false" aria-controls="collapseCreateWallet">
                    Create Wallet
                </button>
            </h2>
            <div id="collapseCreateWallet" class="accordion-collapse collapse" aria-labelledby="headingCreateWallet" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <button type="button" id="create-amazon-wallet-btn" class="btn btn-primary">Create Amazon Wallet</button>
                </div>
                <div class="accordion-body">
                    <button type="button" id="create-amazon-wallet-balance-btn" class="btn btn-primary" style="display:none"></button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    const clientAuthToken = getParameterByName('clientAuthToken');

    document.getElementById('initialize-btn').onclick = async () => {
        try {
            await IxigoSDK.payment.initialize(

                    {
                        "customerId": document.getElementById('initialize-customerId').value,
                        "merchantId": document.getElementById('initialize-merchantId').value,
                        "clientId": document.getElementById('initialize-clientId').value,
                        "provider": document.getElementById('initialize-provider').value,
                        "environment": "sandbox"
                    }

            )
            alert("Successfully initialized SDK")
        } catch(e) {
            alert("Error trying to initialize SDK=${JSON.stringify(e)}")
        }
    }

    document.getElementById('upi-apps-btn').onclick = async () => {
        try {
            const apps = await IxigoSDK.payment.getAvailableUPIApps({
                "provider": document.getElementById('upi-apps-provider').value,
                "orderId": document.getElementById('upi-apps-orderId').value
            })
            alert(`Available UPI Apps=${JSON.stringify(apps)}`)
        } catch(e) {
            alert(`Error trying to fetch UPI apps=${JSON.stringify(e)}`)
        }
    }

    document.getElementById('upi-intent-btn').onclick = async () => {
        try {
            const result = await IxigoSDK.payment.processUPIIntent({
                "provider": document.getElementById('upi-intent-provider').value,
                "orderId": document.getElementById('upi-intent-orderId').value,
                "appPackage": document.getElementById('upi-intent-app-package').value,
                "displayNote": document.getElementById('upi-intent-display-note').value,
                "clientAuthToken": document.getElementById('upi-intent-client-auth-token').value,
                "endUrls": [document.getElementById('upi-intent-end-url').value],
                "amount": document.getElementById('upi-intent-amount').value
            })
            alert(`UPI Intent successful=${JSON.stringify(result)}`)
        } catch(e) {
            alert(`Error trying to process UPI intent=${JSON.stringify(e)}`)
        }
    }

    document.getElementById('read-sms-btn').onclick = async () => {
        try {
            const response = await IxigoSDK.readSms()
            alert(`Sms received=${JSON.stringify(response)}`)
        } catch(e) {
            alert(`Error trying to read SMS=${JSON.stringify(e)}`)
        }
    }

    document.getElementById('scan-credit-card-btn').onclick = async () => {
        try {
            const response = await IxigoSDK.payment.scanCreditCard()
            alert(`Credit Card info received=${JSON.stringify(response)}`)
        } catch(e) {
            alert(`Error trying to scan credit card=${JSON.stringify(e)}`)
        }
    }

    function onWalletLinkSuccess(response, deLinkElement) {
        deLinkElement.textContent = 'balance : ₹' + response.payload.currentBalance;
        deLinkElement.style.display = 'block';
        deLinkElement.setAttribute('data-info', JSON.stringify(response.payload));
    }

    function onWalletDeLinkSuccess(response, deLinkElement) {
        deLinkElement.textContent = '';
        deLinkElement.style.display = 'none';
        deLinkElement.removeAttribute('data-info');
    }

    function deLinkWallet(walletId, walletName, success, error) {
        PaymentSDKAndroid.process(JSON.stringify({
                    "action": "delinkWallet",
                    "walletId" : walletId,
                    "walletName": walletName,
                    "clientAuthToken": clientAuthToken,
                    "gatewayReferenceId": "FLIGHT",
                    "sdkWalletIdentifier": "A2L8B17DHBF6TG",
                    "sdkPresent": "ANDROID_AMAZONPAY_TOKENIZED"
                 }),
            success,
            error
        )
    }

    document.getElementById('create-amazon-wallet-balance-btn').onclick = async () => {
        const onSuccess = "onWalletDeLinkSuccess(JSON.parse('TO_REPLACE_PAYLOAD'), document.getElementById('create-amazon-wallet-balance-btn'))";

        try {
            const div = document.getElementById('create-amazon-wallet-balance-btn');
            const wallet = JSON.parse(div.getAttribute('data-info'));
            deLinkWallet(
                    wallet.id,
                    wallet.wallet,
                    onSuccess,
                    "javascript:alert('error:TO_REPLACE_PAYLOAD')"
            )
        } catch(e) {
           alert(`Error delinking amazon wallet=${JSON.stringify(e)}`)
        }
    }

    document.getElementById('create-amazon-wallet-btn').onclick = async () => {
        const onAmazonLinkSuccess =  "onWalletLinkSuccess(JSON.parse('TO_REPLACE_PAYLOAD'), document.getElementById('create-amazon-wallet-balance-btn'))";

        try {
            PaymentSDKAndroid.process(JSON.stringify({
                    "action": "createWallet",
                    "walletName" : "AMAZONPAY",
                    "clientAuthToken": clientAuthToken,
                    "amount": "100",
                    "gatewayReferenceId": "FLIGHT",
                    "sdkWalletIdentifier": "A2L8B17DHBF6TG",
                    "paymentMethod": "AMAZONPAY",
                    "sdkPresent": "ANDROID_AMAZONPAY_TOKENIZED"
                 }),
             onAmazonLinkSuccess,
            "javascript:alert('error:TO_REPLACE_PAYLOAD')"
            )
        } catch(e) {
           alert(`Error creating amazon wallet=${JSON.stringify(e)}`)
        }
    }

    document.getElementById('refresh-wallets-btn').onclick = async () => {
        try {
            const result = await IxigoSDK.payment.process({
                    "action": "refreshWalletBalances",
                    "clientAuthToken": clientAuthToken
                 }
            );
        } catch(e) {
            console.log(e);
           alert(`Error refreshing wallets=${JSON.stringify(e)}`)
        }
    }

</script>
</body>
</html>

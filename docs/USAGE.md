[[_TOC_]]

# Installation

Inside **root/build.gradle**

```groovy
buildscript {
  repositories {
    // Other repositories...
    maven { url 'https://nexus.ixigo.com/nexus/content/repositories/androidshared' }
  }
}

```

Inside **app/build.gradle**

```groovy
dependencies {
  // Other dependencies...
  implementation "com.ixigo.sdk:ixigo-sdk:1.11.2"
}

```

## Use Snapshots

If you want to test the latest development that is not yet published as a new version, you can add a dependency to our snapshot repository instead.

Inside **root/build.gradle**

```groovy
buildscript {
  repositories {
    // Other repositories...
    maven { url 'https://nexus.ixigo.com/nexus/content/repositories/androidshared-snapshots' }
  }
}

```

Inside **app/build.gradle**

```groovy
dependencies {
  // Other dependencies...
  implementation "com.ixigo.sdk:ixigo-sdk:1.11.2-SNAPSHOT"
}

```

# Usage

## Initialize the SDK

Initialize the SDK calling in your App creation flow. You can only initialize it once.

```kotlin
val appInfo = AppInfo(
  clientId = "<CLIENT_ID>",
  apiKey = "<API_KEY"),
  appVersion = BuildConfig.VERSION_CODE.toLong()
)
IxigoSDK.init(context, appInfo, authProvider, /* Other params */)
```

Access the SDK via its singleton Accessor from an Activity or Fragment

```kotlin
IxigoSDK.instance.flightsStartHome()
```

### Use staging servers

For development purposes, you might want to point the SDK to one of ixigo's staging servers: `build1.ixigo.com`, `build2.ixigo.com`...

You can configure your endpoint while initializing the SDK like this:

```kotlin
IxigoSDK.init(context = context, config = Config.StagingBuildConfig("build3"), /* Other params */)
```

If you want to use a non standard enpoint, you can use `Config` constructor directly:

```kotlin
val config = Config(apiBaseUrl = "http://mycustomhost.com/api")
```

## Authentication

> **Note**: SSO Authentication is not available in Prod yet. You will need to use a `build3` staging server when initializing IxigoSDK, as described in [Use staging servers](#use-staging-servers)

When opening ixigo SDK it is possible to login the user automatically into their ixigo account by exchanging the host App token for an ixigo token. To do that, you need to implement `PartnerTokenProvider` and pass it when initializing `IxigoSDK`

```kotlin
class MyAppPartnerTokenProvider(): PartnerTokenProvider {
  override fun fetchPartnerToken(
      requester: PartnerTokenProvider.Requester,
      callback: PartnerTokenCallback
  ) {
    // Fetch your Host App token if available
    val partnerToken: PartnerToken = /* TODO */
    if (partnerToken == null) {
      // If you could not find it, return the appropiate error.
      callback(Err(PartnerTokenErrorNotLoggedIn()))
    } else {
      // Return the Token
      callback(Ok(partnerToken))
    }
  }
}

IxigoSDK.init(authProvider = MyAppPartnerTokenProvider(), /* Other params*/)
```

`PartnerTokenProvider.Requester` should be used by your implementation to determine how to obtain the token. For instance, if we pass `CUSTOMER`, it would be OK to present a LoginDialog since the Customer initiated this request. Otherwise, we should not show any UI to the customer.

### Payment

If your App supports a custom Payment mechanism, you can implement `PaymentProvider` and use it when initializing `IxigoSDK`

```kotlin
class MyPaymentProvider(): PaymentProvider {
  override fun startPayment(activity: FragmentActivity, input: PaymentInput, callback: PaymentCallback): Boolean {
      TODO("Handle payment")
   }
}

```

If your `PaymentProvider` implementation starts another activity for result, you can implement as well `ActivityResultHandler` to get a callback when the Activity is finished

```kotlin
class MyPaymentProvider(): PaymentProvider, ActivityResultHandler {
  override fun startPayment(activity: FragmentActivity, input: PaymentInput, callback: PaymentCallback): Boolean {
      TODO("Handle payment")
  }

  fun handle(requestCode: Int, resultCode: Int, data: Intent?): Boolean {
    TODO("Handle Activity Result")
  }
}

```

### Analytics

You can get access to events generated by the SDK and log them to your own platform. To do so, you need to create an implementation of `AnalyticsProvider`.

```kotlin
class MyAppAnalyticsProvider() : AnalyticsProvider {
  override fun logEvent(event: Event) {
    // TODO: log events using Firebase, CleverTap, etc...
  }
}
```

You can set your implementation of `AnalyticsProvider` while initializing the SDK

```kotlin
IxigoSDK.init(analyticsProvider = MyAppAnalyticsProvider(), /*...Other init params */)
```

### Configure Appearance

You can configure the appearance of certain UI elements presented by the sdk by providing the following keys in your resources

```xml
<resources>
  ...
  <!-- Primary color: will be used in several UI elements. eg: status bar bg color-->
  <color name="ixigosdk_primary_color">#FF0000</color>
</resources>

```

## Entry Points / Functionality

### Flights

#### Start Flights Funnel

```kotlin
IxigoSDK.instance.flightsStartHome(context)
```

#### Flights Multimodel Search

Use this method to get a Fragment showing Flight trips for a particular search input.
This is useful to integrate in your App's UI where you already have a search form

```kotlin
val searchData = FlightSearchData(...)

val fragment = IxigoSDK.instance.multiModelFragment(searchData)
// Add this fragment to your Activity/Fragment
```

### Buses

In order to access Buses functionality, you need to initialize `BusSDK` after `IxigoSDK` initialization

```kotlin
IxigoSDK.init(...)
BusSDK.init(...)
```

#### Start Bus Funnel

```kotlin
BusSDK.instance.launchHome(context)
```

#### Open Bus Trips

Use this method to open a view showing your Bus bookings

```kotlin
BusSDK.instance.launchTrips(context)
```

#### Bus Multimodel Search

Use this method to get a Fragment showing Bus trips for a particular search input.
This is useful to integrate in your App's UI where you already have a search form

```kotlin
val searchData = BusSearchData(...)

val fragment = BusSDK.instance.multiModelFragment(searchData)
// Add this fragment to your Activity/Fragment
```

#### Get Cheapest Fare

Use this method to get the cheapest bus fare for a given trip

```kotlin
BusSDK.instance.getCheapestFareTrip(CheapestFareInput(...)) {
  when (it) {
    is Ok -> // `it` contains CheapestFareOutput
    is Err -> // Handle Error
  }
}
```

### Trains

In order to access Trains functionality, you need to initialize `TrainsSDK` after `IxigoSDK` initialization

```kotlin
IxigoSDK.init(...)
TrainsSDK.init(...)
```

#### Start Trains Funnel

```kotlin
TrainsSDK.instance.launchHome(context)
```

### Screenshots

| Flights                                                   | Trains                                     | Bus                                               |
| --------------------------------------------------------- | ------------------------------------------ | ------------------------------------------------- |
| Flights Home<br>![](images/flights_home.png)              | Trains Home<br>![](images/trains_home.png) | Bus Home<br>![](images/bus_home.png)              |
| Flights Search<br>![](images/flights_search.png)          |                                            | Bus MultiModel<br>![](images/bus_multimodule.png) |
| Flights MultiModel<br>![](images/flights_multimodule.png) |                                            |                                                   |
